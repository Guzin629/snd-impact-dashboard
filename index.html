
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SND Impact – Full Interactive Dashboard</title>

<style>
/* ================= DISCLAIMER ================= */
.disclaimer{
  background:#fff4d6;border:1px solid #ffd48a;color:#5a3b00;
  border-radius:12px;padding:10px 12px;margin:0 auto 16px;
  max-width:1160px;box-shadow:0 6px 18px rgba(0,0,0,.06);
  display:flex;gap:10px;align-items:center;
}
.disclaimer .dot{width:10px;height:10px;border-radius:50%;background:#ffb020}
.disclaimer b{color:#7a4b00}
.disclaimer .txt{font-size:13px;line-height:1.3}

/* ================= BASE ================= */
:root{
  --ink:#0b1f33; --blue:#0B6FB8; --blue2:#66A3D2;
  --bg:#f5f7fa; --card:#fff; --muted:#6b7a8c;
}
body{font-family:Segoe UI,Arial,sans-serif;background:var(--bg);margin:24px;color:var(--ink)}
.wrap{max-width:1200px;margin:0 auto}
h1,h2{color:#003366;margin:0 0 8px}

/* ================= LAYOUT ================= */
.card{
  background:#fff;border-radius:14px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  padding:18px;margin-bottom:18px
}
.grid{display:grid;grid-template-columns:1.3fr 1fr;gap:20px}
.panel{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
.title-row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}

/* ================= TABLES ================= */
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px 10px;border-bottom:1px solid #eef2f7;text-align:left}
th{font-weight:600;color:#003366}
.heat td,.heat th{border-bottom:1px solid #eef2f7}

/* ================= KPIs ================= */
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kpi{background:#f0f6ff;border:1px solid #e1ecfb;border-radius:10px;padding:10px}
.kpi .v{font-weight:700;font-size:18px;color:#005EB8}

/* ================= BARS ================= */
.bar{height:10px;background:#e9eef6;border-radius:6px;overflow:hidden}
.bar span{display:block;height:100%;background:linear-gradient(90deg,#66A3D2,#0B6FB8)}
.bar-list{display:flex;flex-direction:column;gap:12px}
.bar-track{height:10px;background:#e9eef6;border-radius:6px}
.bar-fill{height:10px;background:linear-gradient(90deg,#66A3D2,#0B6FB8)}

/* ================= SVG ================= */
svg{width:100%;height:auto}
.pt{stroke:#fff;stroke-width:1.5}

/* ================= INPUTS ================= */
select,input,textarea{
  border:1px solid #d4deee;border-radius:8px;
  padding:6px 8px;font-size:12px
}
input[type="checkbox"]{accent-color:#0B6FB8}

/* ================= UTILS ================= */
.btnLink{
  border:1px solid #d4deee;background:#f7fbff;
  padding:6px 10px;border-radius:8px;cursor:pointer
}
.hlRow{outline:2px solid rgba(11,111,184,.8);outline-offset:-2px}
.note{font-size:12px;color:#6b7a8c}
</style>
</head>

<body>

<div class="disclaimer">
  <span class="dot"></span>
  <div class="txt"><b>This is a mock‑up.</b> Data validation in progress.</div>
</div>

<div class="wrap">

 
<!-- ================= STEP #1 ================= -->
<div class="card">
  <div class="title-row">
    <h1>Step #1 – Impact Profile (Interactive)</h1>
    <div class="panel">
      <label>Project</label>
      <select id="projectSel">
        <option value="Frida">Frida</option>
        <option value="Tango" selected>Tango</option>
      </select>
    </div>
  </div>

  <div class="grid">
    <div id="radarWrap">
      <svg id="radarSvg" viewBox="0 0 560 560"></svg>
      <div id="tooltip"></div>
      <div class="panel">
        <span class="note">Scale: 0 (low) to 1 (high)</span>
        <span class="note">Metric: Weighted impact</span>
      </div>
    </div>

    <div>
      <h2>Snapshot</h2>
      <div class="kpis">
        <div class="kpi"><div>Questions</div><div id="kpiQ" class="v">0</div></div>
        <div class="kpi"><div>Yes</div><div id="kpiYes" class="v">0</div></div>
        <div class="kpi"><div>No</div><div id="kpiNo" class="v">0</div></div>
      </div>

      <div class="kpi" style="margin-top:10px">
        <div>Average weighted impact</div>
        <div id="kpiAvg" class="v">0.00</div>
      </div>

      <h2 style="margin-top:16px">Top impacted functions</h2>
      <table id="topTbl">
        <thead>
          <tr>
            <th>Function</th>
            <th style="width:40%">Impact</th>
            <th style="text-align:right">Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<div class="card">
  <h2>Detail by function</h2>
  <table id="detailTbl">
    <thead>
      <tr>
        <th>Function</th>
        <th>#Yes</th>
        <th>#No</th>
        <th>Impact</th>
        <th>Weighted</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ================= STEP #2 ================= -->
<div class="card">
  <h1>Step #2 — Portfolio Aggregation</h1>

  <div class="panel">
    <fieldset>
      <legend>Projects</legend>
      <label><input type="checkbox" class="proj" value="Frida" checked> Frida</label>
      <label style="margin-left:10px"><input type="checkbox" class="proj" value="Tango" checked> Tango</label>
    </fieldset>
    <span class="note">Scale: 0 (low) to 1 (high)</span>
  </div>

  <div class="kpis" id="kpiRow"></div>
</div>

<div class="grid">
  <div class="card">
    <h2>Function Impact Comparison</h2>
    <div id="dbWrap">
      <svg id="dbSvg" viewBox="0 0 760 420"></svg>
    </div>
    <p class="note">Circles = project values · Diamond = weighted aggregate</p>
  </div>

  <div class="card">
    <h2>Heatmap View</h2>
    <table class="heat" id="heatTbl">
      <thead>
        <tr>
          <th>Function</th>
          <th>Average</th>
          <th>Frida</th>
          <th>Tango</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- ================= STEP #3 ================= -->
<div class="card">
  <div class="title-row">
    <h1>Step #3 — Consolidated Impact Map (Question‑Level)</h1>
  </div>

  <div class="kpi">
    <div style="font-weight:600;margin-bottom:6px">
      Top 5 Recurring Impact Drivers Across Projects
    </div>
    <div class="bar-list" id="top5Bars"></div>
  </div>

  <h2 style="margin-top:10px">Interactive Matrix</h2>

  <div class="panel">
    <fieldset>
      <legend>Filter</legend>
      <label class="secLbl">Section</label>
      <select id="secSel" multiple size="6"></select>
    </fieldset>

    <div>
      <label>Search</label>
      <input id="qSearch" placeholder="Search question text">
    </div>

    <div>
      <label>Heavy threshold</label>
      <select id="thrSel">
        <option value="1.25">≥ 1.25</option>
        <option value="1.50" selected>≥ 1.50</option>
        <option value="1.75">≥ 1.75</option>
        <option value="1.90">≥ 1.90</option>
      </select>
    </div>
  </div>

  <table class="heat" id="step3Tbl">
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<!-- ================= STEP #4 ================= -->
<div class="card">
  <div class="title-row">
    <h1>Step #4 — Portfolio Bottlenecks & Actions</h1>
  </div>

  <div class="panel">
    <fieldset>
      <legend>Projects</legend>
      <div id="step4ProjCbs"></div>
      <label style="margin-top:8px;display:block">
        <input type="checkbox" id="sharedOnly" checked>
        Shared only (≥2 projects)
      </label>
    </fieldset>

    <fieldset style="flex:1">
      <legend>Search</legend>
      <input id="step4Search" placeholder="Search bottleneck / mitigation / owner / notes">
    </fieldset>
  </div>

  <div class="kpis" id="step4Kpis"></div>

  <h2>Bottleneck register (editable)</h2>
  <table class="heat" id="step4Tbl">
    <thead></thead>
    <tbody></tbody>
  </table>

  <p class="note">
    Edits are saved locally in your browser (GitHub Pages compatible).
  </p>
</div>

 
<!-- ================= DATA DEFINITIONS ================= -->
<script>

/* ---------- STEP #1 + #2 DATA ---------- */
const DATA = {
  "Frida": {
    "rows": [
      {"Function":"SNO","#Yes":8,"#No":6,"Impact_count":0.5714,"Weighted_Responses":10.46875,"Weighted_Base":18.625,"Impact_weights":0.5621},
      {"Function":"Factory","#Yes":5,"#No":6,"Impact_count":0.4545,"Weighted_Responses":7.5625,"Weighted_Base":15.0625,"Impact_weights":0.5021},
      {"Function":"EM SC","#Yes":5,"#No":9,"Impact_count":0.3571,"Weighted_Responses":6.71875,"Weighted_Base":18.0625,"Impact_weights":0.3720},
      {"Function":"Leaf","#Yes":0,"#No":1,"Impact_count":0,"Weighted_Responses":0,"Weighted_Base":1.53125,"Impact_weights":0},
      {"Function":"Procurement","#Yes":0,"#No":6,"Impact_count":0,"Weighted_Responses":0,"Weighted_Base":8.15625,"Impact_weights":0}
    ]
  },
  "Tango": {
    "rows": [
      {"Function":"Factory","#Yes":6,"#No":5,"Impact_count":0.5455,"Weighted_Responses":8.34375,"Weighted_Base":15.0625,"Impact_weights":0.5539},
      {"Function":"SNO","#Yes":8,"#No":6,"Impact_count":0.5714,"Weighted_Responses":10,"Weighted_Base":18.625,"Impact_weights":0.5369},
      {"Function":"EM SC","#Yes":7,"#No":7,"Impact_count":0.5,"Weighted_Responses":8.65625,"Weighted_Base":18.0625,"Impact_weights":0.4792},
      {"Function":"Leaf","#Yes":0,"#No":1,"Impact_count":0,"Weighted_Responses":0,"Weighted_Base":1.53125,"Impact_weights":0},
      {"Function":"Procurement","#Yes":0,"#No":6,"Impact_count":0,"Weighted_Responses":0,"Weighted_Base":8.15625,"Impact_weights":0}
    ]
  }
};

/* ---------- STEP #3 DATA ---------- */
window.STEP3 = {
  projects: ["Frida","Tango"],
  rows: [
    {section:"SNO",q:1,question:"Will the filter supplier change?",projects:{Frida:{answer:"Yes",weight:0.96875},Tango:{answer:"Yes",weight:0.96875}}},
    {section:"SNO",q:2,question:"Will there be a need to supply base rods from a different site?",projects:{Frida:{answer:"No",weight:0},Tango:{answer:"No",weight:0}}},
    {section:"SNO",q:3,question:"Will the blend supplier change?",projects:{Frida:{answer:"Yes",weight:0.96875},Tango:{answer:"Yes",weight:0.96875}}},
    {section:"EM SC",q:6,question:"Dependant on legal clearance?",projects:{Frida:{answer:"Yes",weight:2},Tango:{answer:"Yes",weight:2}}},
    {section:"Factory",q:11,question:"Installation or modification of machinery?",projects:{Frida:{answer:"Yes",weight:1.90625},Tango:{answer:"Yes",weight:1.90625}}},
    {section:"SNO",q:17,question:"Extended warehousing capacity required?",projects:{Frida:{answer:"Yes",weight:1.90625},Tango:{answer:"Yes",weight:1.90625}}},
    {section:"Factory",q:22,question:"Factory trials / VAT / MQS required?",projects:{Frida:{answer:"Yes",weight:1.625},Tango:{answer:"Yes",weight:1.625}}}
  ],
  top5: [
    {label:"EM SC #6 — Legal clearance",yes_count:2,total_weight:4},
    {label:"SNO #8 — Trademark clearance",yes_count:2,total_weight:4},
    {label:"Factory #11 — Machinery modification",yes_count:2,total_weight:3.81},
    {label:"SNO #17 — Warehousing expansion",yes_count:2,total_weight:3.81},
    {label:"Factory #22 — Trials / VAT / MQS",yes_count:2,total_weight:3.25}
  ]
};

/* ---------- STEP #4 DATA ---------- */
const STEP4_LIBRARY = [
  {rank:1,area:"Legal",q:6,title:"Legal clearance",bottleneck:"Critical path dependency",mitigation:"Unified legal tracker"},
  {rank:2,area:"Trademark",q:8,title:"Trademark clearance",bottleneck:"Approval delays",mitigation:"Agreed SLA"},
  {rank:3,area:"Factory",q:11,title:"Machinery modification",bottleneck:"Engineering capacity",mitigation:"Global calendar"},
  {rank:4,area:"Warehousing",q:17,title:"Warehouse capacity",bottleneck:"Space & capability",mitigation:"Early logistics engagement"},
  {rank:5,area:"Trials",q:22,title:"Factory trials",bottleneck:"Concurrent trials",mitigation:"Trial sequencing"}
];

</script>

 
<script>
/* =========================================================
   UTILITIES
========================================================= */
function polarToXY(cx, cy, r, a){
  return [cx + r * Math.cos(a), cy + r * Math.sin(a)];
}
function clamp(v){ return Math.max(0, Math.min(1, v || 0)); }
function fmt(n){ return (typeof n === "number") ? n.toFixed(2) : "–"; }
function colorFor(v){
  const a = 0.12 + clamp(v) * 0.68;
  return `rgba(11,111,184,${a})`;
}

/* =========================================================
   STEP #1 – RADAR + TABLES
========================================================= */
function drawRadar(rows){
  const svg = document.getElementById("radarSvg");
  svg.innerHTML = "";
  const size = 560, cx = 280, cy = 280, R = 220;
  const ticks = [0.2,0.4,0.6,0.8,1.0];

  ticks.forEach(t=>{
    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",cx); c.setAttribute("cy",cy); c.setAttribute("r",R*t);
    c.setAttribute("fill","none"); c.setAttribute("stroke","#e3eaf3");
    svg.appendChild(c);
  });

  const pts=[];
  rows.forEach((r,i)=>{
    const a = (Math.PI*2*i/rows.length)-Math.PI/2;
    const [x,y] = polarToXY(cx,cy,R*clamp(r.Impact_weights),a);
    pts.push(`${x},${y}`);
    const ax = polarToXY(cx,cy,R,a);
    const l = document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1",cx);l.setAttribute("y1",cy);
    l.setAttribute("x2",ax[0]);l.setAttribute("y2",ax[1]);
    l.setAttribute("stroke","#d7e2ef"); svg.appendChild(l);
  });

  const poly = document.createElementNS("http://www.w3.org/2000/svg","polygon");
  poly.setAttribute("points",pts.join(" "));
  poly.setAttribute("fill","#66A3D2");
  poly.setAttribute("opacity",".35");
  poly.setAttribute("stroke","#0B6FB8");
  poly.setAttribute("stroke-width","2");
  svg.appendChild(poly);
}

function renderStep1(project){
  const rows = DATA[project].rows;
  const yes = rows.reduce((s,r)=>s+r["#Yes"],0);
  const no  = rows.reduce((s,r)=>s+r["#No"],0);
  const resp = rows.reduce((s,r)=>s+r.Weighted_Responses,0);
  const base = rows.reduce((s,r)=>s+r.Weighted_Base,0);

  document.getElementById("kpiQ").textContent = yes+no;
  document.getElementById("kpiYes").textContent = yes;
  document.getElementById("kpiNo").textContent  = no;
  document.getElementById("kpiAvg").textContent = fmt(resp/base);

  const tb = document.querySelector("#topTbl tbody");
  tb.innerHTML="";
  rows.slice().sort((a,b)=>b.Impact_weights-a.Impact_weights).slice(0,3)
    .forEach(r=>{
      tb.insertAdjacentHTML("beforeend",
        `<tr>
          <td>${r.Function}</td>
          <td><div class="bar"><span style="width:${clamp(r.Impact_weights)*100}%"></span></div></td>
          <td style="text-align:right">${fmt(r.Impact_weights)}</td>
        </tr>`);
    });

  const db = document.querySelector("#detailTbl tbody");
  db.innerHTML="";
  rows.forEach(r=>{
    db.insertAdjacentHTML("beforeend",
      `<tr>
        <td>${r.Function}</td>
        <td>${r["#Yes"]}</td>
        <td>${r["#No"]}</td>
        <td>${fmt(r.Impact_count)}</td>
        <td>${fmt(r.Impact_weights)}</td>
      </tr>`);
  });

  drawRadar(rows);
}

/* =========================================================
   STEP #2 – AGGREGATION
========================================================= */
function aggregate(func, projs){
  let w=0,s=0;
  projs.forEach(p=>{
    const r = DATA[p].rows.find(x=>x.Function===func);
    if(r){ w+=r.Weighted_Base; s+=r.Impact_weights*r.Weighted_Base; }
  });
  return w ? s/w : null;
}

function renderStep2(){
  const projs = [...document.querySelectorAll(".proj:checked")].map(x=>x.value);
  const funcs = [...new Set(Object.values(DATA).flatMap(p=>p.rows.map(r=>r.Function)))];

  const k = document.getElementById("kpiRow");
  const vals = funcs.map(f=>aggregate(f,projs)).filter(v=>v!==null);
  k.innerHTML = `<div class="kpi"><div>Portfolio impact</div><div class="v">${fmt(vals.reduce((a,b)=>a+b,0)/vals.length)}</div></div>`;

  const h = document.querySelector("#heatTbl tbody");
  h.innerHTML="";
  funcs.forEach(f=>{
    const a = aggregate(f,projs);
    if(a!==null){
      h.insertAdjacentHTML("beforeend",
        `<tr>
          <td>${f}</td>
          <td style="background:${colorFor(a)}">${fmt(a)}</td>
          <td style="background:${colorFor(aggregate(f,["Frida"]))}">${fmt(aggregate(f,["Frida"]))}</td>
          <td style="background:${colorFor(aggregate(f,["Tango"]))}">${fmt(aggregate(f,["Tango"]))}</td>
        </tr>`);
    }
  });
}

/* =========================================================
   STEP #3 – QUESTION MAP
========================================================= */
(function(){
  const s = document.getElementById("secSel");
  const secs=[...new Set(STEP3.rows.map(r=>r.section))];
  s.innerHTML = secs.map(x=>`<option selected>${x}</option>`).join("");

  const head = document.querySelector("#step3Tbl thead");
  head.innerHTML = `<tr><th>Section</th><th>#</th><th>Question</th>` +
    STEP3.projects.map(p=>`<th>${p}</th>`).join("") + `</tr>`;

  const tb = document.querySelector("#step3Tbl tbody");
  function render(){
    tb.innerHTML="";
    STEP3.rows.forEach(r=>{
      tb.insertAdjacentHTML("beforeend",
        `<tr>
          <td>${r.section}</td>
          <td>${r.q}</td>
          <td>${r.question}</td>
          ${STEP3.projects.map(p=>{
            const c=r.projects[p];
            return `<td style="background:${colorFor(c.weight)}">${c.answer} (${fmt(c.weight)})</td>`;
          }).join("")}
        </tr>`);
    });
  }
  render();
})();

/* =========================================================
   STEP #4 – BOTTLENECKS
========================================================= */
(function(){
  const pWrap = document.getElementById("step4ProjCbs");
  STEP3.projects.forEach(p=>{
    pWrap.insertAdjacentHTML("beforeend",
      `<label><input type="checkbox" class="p4" checked value="${p}"> ${p}</label>`);
  });

  const tb = document.querySelector("#step4Tbl tbody");
  function render(){
    tb.innerHTML="";
    STEP4_LIBRARY.forEach((b,i)=>{
      tb.insertAdjacentHTML("beforeend",
        `<tr>
          <td>${i+1}</td>
          <td>${b.area}</td>
          <td>Q${b.q}</td>
          <td>${b.bottleneck}</td>
          <td><textarea>${b.mitigation}</textarea></td>
        </tr>`);
    });
  }
  render();
})();

/* =========================================================
   INIT
========================================================= */
renderStep1("Tango");
document.getElementById("projectSel").addEventListener("change",e=>renderStep1(e.target.value));
document.querySelectorAll(".proj").forEach(cb=>cb.addEventListener("change",renderStep2));
renderStep2();
</script>

</body>
</html>
